
<!doctype html>
<html lang="fr" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../assets/logo/logo.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-8.5.10">
    
    
      
        <title>Confit - Confit</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.975780f9.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.2505c338.min.css">
        
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../assets/stylesheets/extra.css">
    
      <link rel="stylesheet" href="../assets/termynal/termynal.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent="">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#confit" class="md-skip">
          Aller au contenu
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-component="outdated" hidden>
        
      </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="En-tête">
    <a href=".." title="Confit" class="md-header__button md-logo" aria-label="Confit" data-md-component="logo">
      
  <img src="../assets/logo/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Confit
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Confit
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent=""  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
            </label>
          
        
          
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="" data-md-color-accent=""  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
            </label>
          
        
      </form>
    
    
      <div class="md-header__option">
        <div class="md-select">
          
          <button class="md-header__button md-icon" aria-label="Sélectionner la langue">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m12.87 15.07-2.54-2.51.03-.03A17.52 17.52 0 0 0 14.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04M18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12m-2.62 7 1.62-4.33L19.12 17h-3.24Z"/></svg>
          </button>
          <div class="md-select__inner">
            <ul class="md-select__list">
              
                <li class="md-select__item">
                  <a href="/" hreflang="en" class="md-select__link">
                    English
                  </a>
                </li>
              
                <li class="md-select__item">
                  <a href="/fr/" hreflang="fr" class="md-select__link">
                    Français
                  </a>
                </li>
              
            </ul>
          </div>
        </div>
      </div>
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Rechercher" placeholder="Rechercher" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Effacer" aria-label="Effacer" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initialisation de la recherche
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/aphp/confit" title="Aller au dépôt" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Confit" class="md-nav__button md-logo" aria-label="Confit" data-md-component="logo">
      
  <img src="../assets/logo/logo.png" alt="logo">

    </a>
    Confit
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/aphp/confit" title="Aller au dépôt" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../getting-started.en.md" class="md-nav__link">
        None
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../index.en.md" class="md-nav__link">
        None
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="alternatives/" class="md-nav__link">
        Alternatives &amp; Comparaison
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4">
          Code Reference
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Code Reference" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Code Reference
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_1" type="checkbox" id="__nav_4_1" >
      
      
      
        
          
            
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="reference/">confit</a>
          
            <label for="__nav_4_1">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="confit" data-md-level="2">
        <label class="md-nav__title" for="__nav_4_1">
          <span class="md-nav__icon md-icon"></span>
          confit
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="reference/cli/" class="md-nav__link">
        cli
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="reference/config/" class="md-nav__link">
        config
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="reference/draft/" class="md-nav__link">
        draft
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="reference/errors/" class="md-nav__link">
        errors
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="reference/registry/" class="md-nav__link">
        registry
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="reference/typing/" class="md-nav__link">
        typing
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_1_8" type="checkbox" id="__nav_4_1_8" >
      
      
      
        
          
            
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="reference/utils/">utils</a>
          
            <label for="__nav_4_1_8">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="utils" data-md-level="3">
        <label class="md-nav__title" for="__nav_4_1_8">
          <span class="md-nav__icon md-icon"></span>
          utils
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="reference/utils/collections/" class="md-nav__link">
        collections
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="reference/utils/eval/" class="md-nav__link">
        eval
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="reference/utils/random/" class="md-nav__link">
        random
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="reference/utils/settings/" class="md-nav__link">
        settings
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="reference/utils/xjson/" class="md-nav__link">
        xjson
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="contributing/" class="md-nav__link">
        Contributing to Confit
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="changelog/" class="md-nav__link">
        Changelog
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="roadmap/" class="md-nav__link">
        Roadmap
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table des matières">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table des matières
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#registre" class="md-nav__link">
    Registre
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#systeme-de-typage" class="md-nav__link">
    Système de typage
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cli" class="md-nav__link">
    CLI
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lobjet-config" class="md-nav__link">
    L'objet Config
  </a>
  
    <nav class="md-nav" aria-label="L'objet Config">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#instanciation-dun-objet" class="md-nav__link">
    Instanciation d'un objet
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#interpolation-des-valeurs" class="md-nav__link">
    Interpolation des valeurs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#interpolation-avancee" class="md-nav__link">
    Interpolation avancée
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#drafts-brouillons" class="md-nav__link">
    Drafts (brouillons)
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  <a href="https://github.com/aphp/confit/edit/master/docs/index.fr.md" title="Editer cette page" class="md-content__button md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>


<h1 id="confit">Confit</h1>
<p>Confit est un système de configuration complet et facile d'utilisation qui vise à améliorer la reproductibilité des expériences en s'appuyant sur le système de typage Python, sur des fichiers de configuration minimaux et avec une interface en ligne de commande.</p>
<p>Les trois piliers de ce système de configuration sont le registre <a href="https://github.com/explosion/catalogue">catalogue</a>,
le système de validation <a href="https://github.com/pydantic/pydantic">Pydantic</a> et la bibliothèque de CLI <a href="https://github.com/tiangolo/typer">typer</a>.</p>
<h2 id="registre">Registre</h2>
<p>Le registre <a href="https://github.com/explosion/catalogue">catalogue</a> stocke les différents objects (classes ou fonctions) qui peuvent être composés ensemble pour executer votre programme. Une fois enregistrés, avec le décorateur <code>registry.factory.register</code> ces objets sont accessibles via les <a href="https://packaging.python.org/en/latest/specifications/entry-points/#entry-points-specification">entry-points</a> et peuvent être utilisés dans le système de configuration.
Pour commencer, vous pouvez créer un registre <code>"factory"</code> comme suit:
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">confit</span><span class="w"> </span><span class="kn">import</span> <span class="n">Registry</span><span class="p">,</span> <span class="n">RegistryCollection</span>


<span class="k">class</span><span class="w"> </span><span class="nc">registry</span><span class="p">(</span><span class="n">RegistryCollection</span><span class="p">):</span>
    <span class="n">factory</span> <span class="o">=</span> <span class="n">Registry</span><span class="p">((</span><span class="s2">&quot;my_library&quot;</span><span class="p">,</span> <span class="s2">&quot;factory&quot;</span><span class="p">),</span> <span class="n">entry_points</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div></p>
<div class="admonition tip">
<p class="admonition-title">À quoi cela sert-il ?</p>
<p>Avec ce registre, vous pouvez <em>enregistrer</em> une fonction ou une classe :</p>
<div class="highlight"><pre><span></span><code><span class="nd">@registry</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s2">&quot;my-function&quot;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">my_function</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The value is </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">!&quot;</span><span class="p">)</span>
</code></pre></div>
<p>Maintenant, vous pouvez récupérer dynamiquement la fonction depuis n'importe où :</p>
<div class="highlight"><pre><span></span><code><span class="n">func</span> <span class="o">=</span> <span class="n">registry</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;my-function&quot;</span><span class="p">)</span>
<span class="n">func</span><span class="p">()</span>
<span class="c1"># Out: &quot;The value is 10!&quot;</span>
<span class="n">func</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="c1"># Out: &quot;The value is 42!&quot;</span>
</code></pre></div>
</div>
<h2 id="systeme-de-typage">Système de typage</h2>
<p>Le décorateur Pydantic <code>validate_arguments</code> améliore une fonction pour analyser et valider automatiquement ses arguments à chaque appel, en utilisant le système de validation basé sur le typage Pydantic.
Par exemple, les chaînes de caractères peuvent être automatiquement converties en objets Path, ou en objets datetime ou en nombres, en fonction de l'annotation de type de l'argument.</p>
<p>Combiné avec notre système de configuration, les dictionnaires passés en arguments à une fonction décorée peuvent être "castés" en classes instanciées si ces classes étaient elles-mêmes décorées.</p>
<h2 id="cli">CLI</h2>
<p>Nous fournissons l'objet <code>confit.Cli</code>, un wrapper basé sur Typer qui transforme une fonction en une interface de ligne de commande. Une fois décorée avec <code>@app.command</code>, la fonction peut être exécutée depuis le terminal et accepte automatiquement un ou plusieurs fichiers <code>--config</code> contenant ses paramètres, ainsi que des paramètres simples (qui ont la priorité).</p>
<p>Par exemple, nous allons décorer la fonction <code>cool_function</code> pour la rendre disponible en tant qu'interface de ligne de commande, et placer certains de ses paramètres dans un fichier de configuration <code>config.yml</code> :</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">confit</span><span class="w"> </span><span class="kn">import</span> <span class="n">Cli</span><span class="p">,</span> <span class="n">Registry</span><span class="p">,</span> <span class="n">RegistryCollection</span>


<span class="k">class</span><span class="w"> </span><span class="nc">registry</span><span class="p">(</span><span class="n">RegistryCollection</span><span class="p">):</span>
    <span class="n">factory</span> <span class="o">=</span> <span class="n">Registry</span><span class="p">((</span><span class="s2">&quot;myapp&quot;</span><span class="p">,</span> <span class="s2">&quot;factory&quot;</span><span class="p">),</span> <span class="n">entry_points</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>


<span class="nd">@registry</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s2">&quot;my-class&quot;</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">MyClass</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value1</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">value2</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value1</span> <span class="o">=</span> <span class="n">value1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value2</span> <span class="o">=</span> <span class="n">value2</span>


<span class="n">app</span> <span class="o">=</span> <span class="n">Cli</span><span class="p">()</span>


<span class="nd">@app</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;cool_function&quot;</span><span class="p">,</span> <span class="n">registry</span><span class="o">=</span><span class="n">registry</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">cool_function</span><span class="p">(</span>
    <span class="n">modelA</span><span class="p">:</span> <span class="n">MyClass</span><span class="p">,</span>
    <span class="n">modelB</span><span class="p">,</span>
    <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
<span class="p">):</span>
    <span class="o">...</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">app</span><span class="p">()</span>
</code></pre></div>
<div class="highlight"><span class="filename">config.yml</span><pre><span></span><code><span class="c1"># Pas besoin de @factory ici, car le type hint est suffisant</span>
<span class="nt">modelA</span><span class="p">:</span>
<span class="w">  </span><span class="nt">value1</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
<span class="w">  </span><span class="nt">value2</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1.5</span>

<span class="c1"># ModelB n&#39;est pas type hinté, alors nous devons indiquer comment l&#39;instancier</span>
<span class="nt">modelB</span><span class="p">:</span>
<span class="w">  </span><span class="s">&quot;@factory&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;my-class&quot;</span>
<span class="w">  </span><span class="nt">value1</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
<span class="w">  </span><span class="nt">value2</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3.5</span>

<span class="nt">cool_function</span><span class="p">:</span>
<span class="w">  </span><span class="nt">modelA</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${modelA}</span>
<span class="w">  </span><span class="nt">modelB</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${modelB}</span>
</code></pre></div>
<p>Il ne reste plus qu'à exécuter le script avec l'option <code>--config</code>, qui lira le fichier de configuration et instanciera les objets en conséquence:</p>
<div class="highlight"><pre><span></span><code>python<span class="w"> </span>script.py<span class="w"> </span>--config<span class="w"> </span>config.yml<span class="w"> </span>--seed<span class="w"> </span><span class="m">42</span>
</code></pre></div>
<p>Les arguments de ligne de commande remplacent les valeurs de la configuration. Si plusieurs fichiers de configuration sont fournis, ils sont fusionnés dans l'ordre.</p>
<h2 id="lobjet-config">L'objet Config</h2>
<p>L'objet de configuration, la classe <code>Config</code>, est un dictionnaire augmenté qui peut être utilisé pour lire et écrire des fichiers <code>cfg</code>, interpoler des variables et instancier des composants via le registre avec des clés spéciales <code>@factory</code>.
Un fichier cfg peut être utilisé directement comme entrée pour une fonction décorée en CLI.</p>
<p>Nous montrerons ci-dessous des exemples partiels de complexité croissante. Voir [ici][un-example-simple] pour un exemple complet.</p>
<h3 id="instanciation-dun-objet">Instanciation d'un objet</h3>
<div class="highlight"><span class="filename">script.py</span><pre><span></span><code><span class="nd">@registry</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s2">&quot;my-class&quot;</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">MyClass</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value1</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">value2</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value1</span> <span class="o">=</span> <span class="n">value1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value2</span> <span class="o">=</span> <span class="n">value2</span>
</code></pre></div>
<div class="tabbed-set tabbed-alternate" data-tabs="1:2"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio" /><input id="__tabbed_1_2" name="__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="__tabbed_1_1">INI syntax</label><label for="__tabbed_1_2">YAML syntax</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><span class="filename">config.cfg</span><pre><span></span><code><span class="k">[myclass]</span>
<span class="na">@factory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;my-class&quot;</span>
<span class="na">value1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">1.1</span>
<span class="na">value2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">2.5</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><span class="filename">config.yaml</span><pre><span></span><code><span class="nt">myclass</span><span class="p">:</span>
<span class="w">  </span><span class="s">&quot;@factory&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;my-class&quot;</span>
<span class="w">  </span><span class="nt">value1</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1.1</span>
<span class="w">  </span><span class="nt">value2</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2.5</span>
</code></pre></div>
</div>
</div>
</div>
<p>Ici, <strong>Confit</strong> va :</p>
<ul>
<li>Analyser la configuration</li>
<li>Récupérer la classe cible à partir du registre</li>
<li>Valider les paramètres si nécessaire (dans ce cas, <code>value1</code> est typé en tant qu'entier, il sera donc converti en entier en définissant <code>value1=1</code>)</li>
<li>Instancier la classe en utilisant les paramètres validés</li>
</ul>
<h3 id="interpolation-des-valeurs">Interpolation des valeurs</h3>
<p>Lorsque plusieurs sections de la configuration doivent accéder à la même valeur, vous pouvez utiliser une référence avec la syntaxe <code>${&lt;section.value&gt;}</code> :</p>
<div class="tabbed-set tabbed-alternate" data-tabs="2:2"><input checked="checked" id="__tabbed_2_1" name="__tabbed_2" type="radio" /><input id="__tabbed_2_2" name="__tabbed_2" type="radio" /><div class="tabbed-labels"><label for="__tabbed_2_1">INI syntax</label><label for="__tabbed_2_2">YAML syntax</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><span class="filename">config.cfg</span><pre><span></span><code><span class="k">[myclass]</span>
<span class="na">@factory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;my-class&quot;</span>
<span class="na">value1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">1.1</span>
<span class="na">value2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">${other_values.value3}</span>

<span class="k">[other_values]</span>
<span class="na">value3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">10</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><span class="filename">config.yaml</span><pre><span></span><code><span class="nt">myclass</span><span class="p">:</span>
<span class="w">  </span><span class="s">&quot;@factory&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;my-class&quot;</span>
<span class="w">  </span><span class="nt">value1</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1.1</span>
<span class="w">  </span><span class="nt">value2</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${other_values.value3}</span>
</code></pre></div>
</div>
</div>
</div>
<p>Ici, <code>value2</code> sera défini à 10, comme <code>value3</code>.</p>
<h3 id="interpolation-avancee">Interpolation avancée</h3>
<p>Vous pouvez même passer des objets instanciés ! Supposons que nous ayons une classe enregistrée <code>myOtherClass</code> attendant une instance de <code>MyClass</code> en entrée. Vous pourriez utiliser la configuration suivante :</p>
<div class="tabbed-set tabbed-alternate" data-tabs="3:2"><input checked="checked" id="__tabbed_3_1" name="__tabbed_3" type="radio" /><input id="__tabbed_3_2" name="__tabbed_3" type="radio" /><div class="tabbed-labels"><label for="__tabbed_3_1">INI syntax</label><label for="__tabbed_3_2">YAML syntax</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><span class="filename">config.cfg</span><pre><span></span><code><span class="k">[func]</span>
<span class="na">@factory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;my-other-class&quot;</span>
<span class="na">obj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">${myclass}</span>

<span class="k">[myclass]</span>
<span class="na">@factory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;my-class&quot;</span>
<span class="na">value1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">1.1</span>
<span class="na">value2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">${other_values.value3}</span>

<span class="k">[other_values]</span>
<span class="na">value3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">10</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><span class="filename">config.yaml</span><pre><span></span><code><span class="nt">func</span><span class="p">:</span>
<span class="w">  </span><span class="s">&quot;@factory&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;my-other-class&quot;</span>
<span class="w">  </span><span class="nt">obj</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${myclass}</span>

<span class="nt">myclass</span><span class="p">:</span>
<span class="w">    </span><span class="s">&quot;@factory&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;my-class&quot;</span>
<span class="w">    </span><span class="nt">value1</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1.1</span>
<span class="w">    </span><span class="nt">value2</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${other_values.value3}</span>

<span class="nt">other_values</span><span class="p">:</span>
<span class="w">    </span><span class="nt">value3</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span>
</code></pre></div>
</div>
</div>
</div>
<p>Enfin, vous pouvez vouloir accéder à certains attributs des classes Python qui sont disponibles <em>après</em> l'instanciation, mais pas présents dans le fichier de configuration. Par exemple, modifions notre classe <code>MyClass</code> :</p>
<div class="highlight"><span class="filename">script.py</span><pre><span></span><code><span class="gu">@registry.factory.register(&quot;my-class&quot;)</span>
class MyClass:
<span class="w"> </span>   def __init__(self, value1: int, value2: float):
<span class="w"> </span>       self.value1 = value1
<span class="w"> </span>       self.value2 = value2
<span class="gi">+         self.hidden_value = 99</span>
</code></pre></div>
<p>Pour accéder à ces valeurs directement dans le fichier de configuration, utilisez la syntaxe <code>${&lt;obj:attribut&gt;}</code> (remarquez les <strong>deux points</strong> au lieu du <strong>point</strong>)</p>
<div class="tabbed-set tabbed-alternate" data-tabs="4:2"><input checked="checked" id="__tabbed_4_1" name="__tabbed_4" type="radio" /><input id="__tabbed_4_2" name="__tabbed_4" type="radio" /><div class="tabbed-labels"><label for="__tabbed_4_1">INI syntax</label><label for="__tabbed_4_2">YAML syntax</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><span class="filename">config.cfg</span><pre><span></span><code><span class="k">[object]</span>
<span class="na">@factory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;my-class&quot;</span>
<span class="na">value1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">1.1</span>
<span class="na">value2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">2.5</span>

<span class="k">[other_values]</span>
<span class="na">value3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">${object:hidden_value}</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><span class="filename">config.yaml</span><pre><span></span><code><span class="nt">object</span><span class="p">:</span>
<span class="w">  </span><span class="s">&quot;@factory&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;my-class&quot;</span>
<span class="w">  </span><span class="nt">value1</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1.1</span>
<span class="w">  </span><span class="nt">value2</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2.5</span>

<span class="nt">other_values</span><span class="p">:</span>
<span class="w">    </span><span class="nt">value3</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${object:hidden_value}</span>
</code></pre></div>
</div>
</div>
</div>
<h2 id="drafts-brouillons">Drafts (brouillons)</h2>
<p>Lorsqu'un composant est instancié avec <code>MyClass.draft(...)</code> au lieu de <code>MyClass(...)</code>, l'appel renvoie un objet <code>Draft</code> plutôt que de d'instancier l'objet immédiatement.</p>
<p>Ce "brouillon" conserve les paramètres fournis et peut être instancié plus tard via <code>Draft.instantiate()</code>. C'est notamment utile lorsque tous les paramètres ne sont pas prêts au même moment, et que l'instantiation de l'objet peut être deleguée à un autre composant.</p>
<p>Cela peut être vu comme une version simplifiée du <a href="https://en.wikipedia.org/wiki/Builder_pattern">pattern de construction</a> en programmation.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">confit</span><span class="w"> </span><span class="kn">import</span> <span class="n">validate_arguments</span>


<span class="nd">@validate_arguments</span>
<span class="k">class</span><span class="w"> </span><span class="nc">MyClass</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value1</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">value2</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value1</span> <span class="o">=</span> <span class="n">value1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value2</span> <span class="o">=</span> <span class="n">value2</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;MyClass(value1=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">value1</span><span class="si">}</span><span class="s2">, value2=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">value2</span><span class="si">}</span><span class="s2">)&quot;</span>


<span class="n">draft</span> <span class="o">=</span> <span class="n">MyClass</span><span class="o">.</span><span class="n">draft</span><span class="p">(</span><span class="n">value1</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="nb">type</span><span class="p">(</span><span class="n">draft</span><span class="p">)</span>
<span class="c1"># Out: Draft[MyClass]</span>

<span class="n">draft</span><span class="o">.</span><span class="n">instantiate</span><span class="p">(</span><span class="n">value2</span><span class="o">=</span><span class="mf">2.5</span><span class="p">)</span>
<span class="c1"># Out: MyClass(value1=1, value2=2.5)</span>
</code></pre></div>
<p>Depuis un fichier de configuration, un brouillon peut être instancié en utilisant la syntaxe suivante :
<div class="highlight"><pre><span></span><code><span class="nt">modelA</span><span class="p">:</span>
<span class="w">    </span><span class="s">&quot;@draft&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my-class !draft</span>
<span class="w">    </span><span class="nt">value1</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
</code></pre></div></p>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.tracking", "navigation.indexes", "content.code.annotate"], "search": "../assets/javascripts/workers/search.16e2a7d4.min.js", "translations": {"clipboard.copied": "Copi\u00e9 dans le presse-papier", "clipboard.copy": "Copier dans le presse-papier", "search.config.lang": "fr", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Rechercher", "search.result.more.one": "1 de plus sur cette page", "search.result.more.other": "# de plus sur cette page", "search.result.none": "Aucun document trouv\u00e9", "search.result.one": "1 document trouv\u00e9", "search.result.other": "# documents trouv\u00e9s", "search.result.placeholder": "Taper pour d\u00e9marrer la recherche", "search.result.term.missing": "Non trouv\u00e9", "select.version.title": "S\u00e9lectionner la version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../assets/javascripts/bundle.5a2dcb6a.min.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
      
        <script src="../assets/termynal/termynal.js"></script>
      
    
    
  </body>
</html>